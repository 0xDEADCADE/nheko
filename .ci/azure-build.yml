
steps:
- bash: |
    export CXX=${CXX_COMPILER}
    export CC=${C_COMPILER}
    # Use TRAVIS_TAG if defined, or the short commit SHA otherwise
    export VERSION=${TRAVIS_TAG:-$(git rev-parse --short HEAD)}

    ./.ci/install.sh
    export PATH=/usr/local/bin:${PATH}

    ./.ci/script.sh
    sed -i -e "s/VERSION_NAME_VALUE/${VERSION}/g" ./.ci/bintray-release.json || true
    cp ./.ci/bintray-release.json .
- task: CopyFiles@2
  inputs:
    #sourceFolder: # Optional
    contents: |
      '**/*.dmg'
      '**/*.AppImage'
    targetFolder: $(Build.ArtifactStagingDirectory)
    #cleanTargetFolder: false # Optional
    #overWrite: false # Optional
    #flattenFolders: false # Optional
- task: GitHubRelease@0
  inputs:
    gitHubConnection: nheko-reborn
    repositoryName: '$(Build.Repository.Name)'
    action: 'create' # Options: create, edit, delete
    target: '$(Build.SourceVersion)' # Required when action == Create || Action == Edit
    tagSource: 'auto' # Required when action == Create# Options: auto, manual
    #tag: # Required when action == Edit || Action == Delete || TagSource == Manual
    #title: # Optional
    releaseNotesSource: 'file' # Optional. Options: file, input
    releaseNotesFile: CHANGELOG.md # Optional
    #releaseNotes: # Optional
    assets: '$(Build.ArtifactStagingDirectory)/*' # Optional
    assetUploadMode: 'delete' # Optional. Options: delete, replace
    #isDraft: false # Optional
    isPreRelease: true # Optional
    addChangeLog: true # Optional